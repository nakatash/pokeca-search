# ポケカサーチ ディレクトリ構成

## プロジェクト構成

```
pokeca-search/
├── app/                          # Next.js App Router
│   ├── (auth)/                   # 認証が必要なルートグループ
│   │   ├── mypage/
│   │   │   ├── page.tsx
│   │   │   ├── favorites/
│   │   │   │   └── page.tsx
│   │   │   └── alerts/
│   │   │       └── page.tsx
│   │   └── layout.tsx
│   │
│   ├── (public)/                 # 公開ルートグループ
│   │   ├── cards/
│   │   │   └── [setId]/
│   │   │       └── [cardId]/
│   │   │           ├── page.tsx
│   │   │           └── opengraph-image.tsx
│   │   ├── sets/
│   │   │   └── [setId]/
│   │   │       └── page.tsx
│   │   ├── rankings/
│   │   │   └── [type]/
│   │   │       └── page.tsx
│   │   ├── search/
│   │   │   └── page.tsx
│   │   └── blog/
│   │       ├── page.tsx
│   │       └── [slug]/
│   │           └── page.tsx
│   │
│   ├── api/                      # API Routes
│   │   ├── auth/
│   │   │   ├── login/
│   │   │   │   └── route.ts
│   │   │   ├── logout/
│   │   │   │   └── route.ts
│   │   │   └── line/
│   │   │       └── callback/
│   │   │           └── route.ts
│   │   ├── cards/
│   │   │   ├── route.ts          # GET /api/cards
│   │   │   └── [id]/
│   │   │       └── route.ts      # GET /api/cards/{id}
│   │   ├── rankings/
│   │   │   └── route.ts          # GET /api/rankings
│   │   ├── favorites/
│   │   │   └── route.ts          # POST/DELETE /api/favorites
│   │   ├── alerts/
│   │   │   └── route.ts          # GET/POST/PUT/DELETE /api/alerts
│   │   └── webhooks/
│   │       ├── line/
│   │       │   └── route.ts
│   │       └── contentful/
│   │           └── route.ts
│   │
│   ├── layout.tsx                # ルートレイアウト
│   ├── page.tsx                  # ホームページ
│   ├── loading.tsx               # グローバルローディング
│   ├── error.tsx                 # エラーハンドリング
│   ├── not-found.tsx             # 404ページ
│   └── globals.css               # グローバルCSS
│
├── components/                   # UIコンポーネント
│   ├── ui/                       # 基本UIコンポーネント
│   │   ├── button.tsx
│   │   ├── card.tsx
│   │   ├── input.tsx
│   │   ├── badge.tsx
│   │   ├── modal.tsx
│   │   ├── skeleton.tsx
│   │   └── toast.tsx
│   │
│   ├── cards/                    # カード関連コンポーネント
│   │   ├── card-tile.tsx
│   │   ├── card-grid.tsx
│   │   ├── price-table.tsx
│   │   ├── price-badge.tsx
│   │   ├── price-chart.tsx
│   │   └── grade-selector.tsx
│   │
│   ├── shop/                     # ショップ関連
│   │   ├── shop-trust-badge.tsx
│   │   └── shipping-info.tsx
│   │
│   ├── search/                   # 検索関連
│   │   ├── search-bar.tsx
│   │   ├── filter-panel.tsx
│   │   └── sort-selector.tsx
│   │
│   ├── user/                     # ユーザー関連
│   │   ├── favorite-button.tsx
│   │   ├── alert-modal.tsx
│   │   └── login-modal.tsx
│   │
│   └── layout/                   # レイアウト関連
│       ├── header.tsx
│       ├── footer.tsx
│       ├── nav-menu.tsx
│       └── breadcrumb.tsx
│
├── lib/                          # ライブラリ・ユーティリティ
│   ├── api/                      # API クライアント
│   │   ├── client.ts
│   │   ├── cards.ts
│   │   ├── shops.ts
│   │   ├── auth.ts
│   │   └── types.ts
│   │
│   ├── db/                       # データベース
│   │   ├── client.ts
│   │   ├── schema.ts
│   │   └── migrations/
│   │       └── 001_initial.sql
│   │
│   ├── cache/                    # キャッシュ
│   │   └── redis.ts
│   │
│   ├── auth/                     # 認証
│   │   ├── jwt.ts
│   │   ├── session.ts
│   │   └── middleware.ts
│   │
│   ├── utils/                    # ユーティリティ
│   │   ├── format.ts
│   │   ├── calculate.ts
│   │   ├── validate.ts
│   │   └── constants.ts
│   │
│   └── hooks/                    # カスタムフック
│       ├── use-auth.ts
│       ├── use-favorites.ts
│       ├── use-infinite-scroll.ts
│       └── use-debounce.ts
│
├── workers/                      # バックグラウンドワーカー
│   ├── ingestor/                 # 価格取得ワーカー
│   │   ├── index.ts
│   │   ├── parsers/
│   │   │   ├── base.ts
│   │   │   ├── hareruya.ts
│   │   │   ├── surugaya.ts
│   │   │   └── card-rush.ts
│   │   └── normalizer.ts
│   │
│   ├── aggregator/               # 集計ワーカー
│   │   └── index.ts
│   │
│   ├── ranker/                   # ランキング計算
│   │   └── index.ts
│   │
│   └── notifier/                 # 通知ワーカー
│       ├── index.ts
│       ├── email.ts
│       └── line.ts
│
├── types/                        # TypeScript型定義
│   ├── cards.ts
│   ├── shops.ts
│   ├── users.ts
│   └── api.ts
│
├── styles/                       # スタイル
│   └── tailwind/
│       └── plugins/
│
├── public/                       # 静的ファイル
│   ├── images/
│   │   ├── logo.svg
│   │   └── og-default.png
│   ├── favicon.ico
│   └── robots.txt
│
├── scripts/                      # スクリプト
│   ├── seed.ts                   # 初期データ投入
│   ├── migrate.ts                # マイグレーション
│   └── generate-sitemap.ts       # サイトマップ生成
│
├── tests/                        # テスト
│   ├── unit/
│   ├── integration/
│   └── e2e/
│
├── .env.example                  # 環境変数サンプル
├── .gitignore
├── docker-compose.yml            # ローカル開発環境
├── next.config.js                # Next.js設定
├── package.json
├── tsconfig.json                 # TypeScript設定
├── tailwind.config.ts            # Tailwind設定
├── prettier.config.js            # Prettier設定
├── eslint.config.js              # ESLint設定
├── jest.config.js                # Jest設定
└── README.md
```

## 主要ディレクトリの説明

### `/app`
Next.js 14のApp Routerディレクトリ。ルーティングとページコンポーネント。

### `/components`
再利用可能なUIコンポーネント。機能別に整理。

### `/lib`
ビジネスロジック、API通信、データベース接続などの中核機能。

### `/workers`
バックグラウンドで動作するワーカー（価格取得、集計、通知など）。

### `/types`
TypeScriptの型定義ファイル。

## 環境変数

```env
# Database
DATABASE_URL=
DIRECT_URL=

# Redis
KV_URL=
KV_REST_API_URL=
KV_REST_API_TOKEN=
KV_REST_API_READ_ONLY_TOKEN=

# Auth
JWT_SECRET=
NEXTAUTH_URL=
NEXTAUTH_SECRET=

# LINE
LINE_CHANNEL_ID=
LINE_CHANNEL_SECRET=
LINE_CHANNEL_ACCESS_TOKEN=

# SendGrid
SENDGRID_API_KEY=
SENDGRID_FROM_EMAIL=

# CMS
CONTENTFUL_SPACE_ID=
CONTENTFUL_ACCESS_TOKEN=
CONTENTFUL_PREVIEW_TOKEN=

# Analytics
NEXT_PUBLIC_GA_ID=

# Upstash QStash
QSTASH_URL=
QSTASH_TOKEN=
```